digraph General {

    node [style=filled; fillcolor="#FCF9A5"];
    graph [nodesep=1, ranksep=0.2, mindist=0.5];

    subgraph cluster_DC {
        style=filled;
        color=lightgrey;
        node [style=filled,color=red];

        reason1 [label = "Disconnect Code 110 \n(Can't find Customer or Customer locked)"; shape=box; sides=4 ];
        reason2 [label = "Disconnect code 8000 \n(No enought customer balance)"; shape=box; sides=4 ];
        reason3 [label = "Disconnect code 8001 \n(Destination blacklisted)"; shape=box; sides=4 ];
        reason4 [label = "Disconnect code 8002 \n(Source blacklisted)"; shape=box; sides=4 ];
        reason5 [label = "Disconnect code 8003 \n(No response from LNP DB)"; shape=box; sides=4 ];
        reason6 [label = "Disconnect Code 111 \n(Can't find destination prefix)"; shape=box; sides=4 ];
        reason7 [label = "Disconnect Code 112 \n(Rejected by destination)"; shape=box; sides=4 ];
        reason8 [label = "Disconnect Code 113 \n(No routes)"; shape=box; sides=4 ];

        reason1->reason2 [style=invis];
        reason2->reason3 [style=invis];
        reason3->reason4 [style=invis];
        reason4->reason5 [style=invis];
        reason5->reason6 [style=invis];
        reason6->reason7 [style=invis];
        reason7->reason8 [style=invis];
        label = "Disconnect Reasons";
    }


    block1 [label = "Authentication / Authorization"; shape=box; sides=4 ];
    block2 [label = "Checking balance of Customer"; shape=box; sides=4 ];
    block3 [label = "Pre-Routing numbers translations"; shape=box; sides=4 ];
    block4 [label = "DST Numberlist processing"; shape=box; sides=4 ];
    block5 [label = "SRC Numberlist processing"; shape=box; sides=4 ];
    block6 [label = "Areas and Tag detection"; shape=box; sides=4 ];
    block7 [label = "Routing plan searching"; shape=box; sides=4 ];
    block8 [label = "Make Query to LNP database (if needed)"; shape=box; sides=4 ];
    block9 [label = "Search Destination for a call"; shape=box; sides=4 ];
    block10 [label = "Detect routing algorithm for routing plan"; shape=box; sides=4 ];
    block11 [label = "Search routes for a call"; shape=box; sides=4 ];

    block12 [label = "List of selected dialpeers sorted by chosen routing algorithm"; shape=hexagon];
    block13 [label = "Detect gateways capabilities"; shape=box; sides=4 ];
    block14 [label = "Pass routes to switch node"; shape=box; sides=4 ];
    block15 [label = "Switch node is trying to connect a call"; shape=box; sides=4 ];
    block16 [label = "Change customer's and vendor's balance at billing subsystem"; shape=box; sides=4 ];
    block17 [label = "Post-routing numbers translations"; shape=box; sides=4 ];
    block18 [label = "Writing CDR for each termination attempt + writing statistic for route/gateway"; shape=box; sides=4 ];
    end [shape=Msquare];

    block1 -> block2 [color=green];
    block1 -> reason1 [color=red];

    block2 -> block3 [color=green];
    block2 -> reason2 [color=red];
    block3 -> block4 [color=green];
    block4 -> block5 [color=green];
    block4 -> reason3 [color=red];
    block5 -> block6 [color=green];
    block5 -> reason4 [color=red];
    block6 -> block7 [color=green];
    block7 -> block8 [color=green];
    block8 -> block9 [color=green];
    block8 -> reason5 [color=red];
    block9 -> block10 [color=green];
    block9 -> reason6 [color=red];
    block9 -> reason7 [color=red];
    block10 -> block11 [color=green];
    block11 -> block12 [color=green];
    block11 -> reason8 [color=red];
    block12 -> block13 [color=green];
    block13 -> block14 [color=green];
    block14 -> block15 [color=green];
    block15 -> block16 [color=green];
    block16 -> block17 [color=green];
    block17 -> block18 [color=green];
    block18 -> block12 [color=green];
    block12 -> end [color=green];


}